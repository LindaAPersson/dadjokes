{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}

            <h2># {{joke.title}}</h2>
            <p>{{joke.joke_text | safe}}</p>
            <p><span>{{joke.creator_image}}</span></span>Author: {{joke.creator}}</p>
            <p>Made: {{joke.created_on}}</p>
            
<!-- Displaying likes -->
{% if user.is_authenticated %}
  <form method="post" action="{% url 'like_jokes' joke.title joke.id %}">
    {% csrf_token %}
    {% if liked%}
      <button id="LikeButton" name="joke_id" value="{{ joke.id }}" type="submit"><i class="fa-solid fa-heart  red darken-2"></i></button> <p>{{ likes_count }} Likes</p>
    {% else %}  
      <button id="LikeButton" name="joke_id" value="{{ joke.id }}" type="submit"><i class="fa-solid fa-heart"></i></button><p>{{ likes_count }} Likes</p>
    {% endif %}
  </form>
{% else %}
  <i class="fa-solid fa-heart"></i>{{ likes_count }} Likes
               
{% endif %}

<!-- Displaying count of comments -->
<div class="row">
    <div class="col-12">
      <strong class="text-secondary">
        <i class="far fa-comments"></i> {{ comment_count }} 
      </strong>
    </div>
        <div class="col-12">
        <hr>
        </div>
    </div>
  <!-- Displaying Comments -->
    <div class="row">
        <div class="col-md-8 card mb-4  mt-3 ">
        <h3>Comments:</h3>
        <div class="card-body">
            <!-- We want a for loop inside the empty control tags
            to iterate through each comment in comments -->
            {% for comment in comments %}
              <div class="p-2 comments
              {% if not comment.approved and comment.creator == user %}
              faded{% elif not comment.approved %} d-none{% endif %}">
              <p class="font-weight-bold">
                  {{ comment.creator }}
                  <span class="font-weight-normal">
                  {{ comment.created_on }}
                  </span> wrote:
              </p>
              <div id="comment{{ comment.id }}">
                  {{ comment.comment_text | safe }}
              </div>
              {% if not comment.approved and comment.creator == user %}
              <p class="approval">
                  This comment is awaiting approval
              </p>
              {% endif %}
              {% if user.is_authenticated and comment.creator == user %}
              <button class="btn btn-edit" comment_id="{{ comment.id }}">Edit</button>
              <button data-target="modal1" class="btn modal-trigger btn-delete" comment_id="{{ comment.id }}">Delete</button>
              {% endif %}
              </div>
            <!-- Our for loop ends here -->
            {% endfor %}
        </div>
    </div>
    <!-- Creating New Comments -->
    <div>
        <div>
          {% if user.is_authenticated %}
          <h3>Leave a comment:</h3>
          <p>Posting as: {{ user.username }}</p>
          <form id="commentForm" method="post">
            {{ comment_form }}
            {% csrf_token %}
            <button id="submitButton" type="submit"></a>Submit</button>
          </form>
          {% else %}
          <p>Log in to leave a comment</p>
          {% endif %}

          
        </div>
      </div>
</div>
<!-- Delete confirmation modal -->
<div id="modal1" class="modal">
  <div class="modal-content">
    <h4>Delete comment?</h4>
    <p>Are you sure you want to delete your comment?
      This action cannot be undone.</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary"data-bs-dismiss="modal">Close</button>
    <a id="deleteConfirm" href="#" class="btn btn-danger modal-close waves-effect waves-green btn-flat">Delete</a>
    
  </div>
</div>


{% endblock %}
{% block extras %}
<script src="{% static 'js/comments.js' %}"></script>
{% endblock %}